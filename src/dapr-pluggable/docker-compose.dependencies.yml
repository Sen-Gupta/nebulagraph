# Copyright 2022 The Dapr Authors
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#     http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

version: '3.9'

services:
  # NebulaGraph Meta Service
  nebula-metad:
    image: vesoft/nebula-metad:v3.8.0
    container_name: nebula-metad
    restart: unless-stopped
    ports:
      - "9559:9559"
      - "19559:19559"
    environment:
      - USER=root
    volumes:
      - nebula-meta:/usr/local/nebula/data
      - nebula-logs:/usr/local/nebula/logs
    networks:
      - nebula-net
    command:
      - --meta_server_addrs=nebula-metad:9559
      - --local_ip=nebula-metad
      - --ws_ip=nebula-metad
      - --port=9559
      - --ws_http_port=19559

  # NebulaGraph Storage Service
  nebula-storaged:
    image: vesoft/nebula-storaged:v3.8.0
    container_name: nebula-storaged
    restart: unless-stopped
    ports:
      - "9779:9779"
      - "19779:19779"
    environment:
      - USER=root
    volumes:
      - nebula-storage:/usr/local/nebula/data
      - nebula-logs:/usr/local/nebula/logs
    networks:
      - nebula-net
    depends_on:
      - nebula-metad
    command:
      - --meta_server_addrs=nebula-metad:9559
      - --local_ip=nebula-storaged
      - --ws_ip=nebula-storaged
      - --port=9779
      - --ws_http_port=19779

  # NebulaGraph Graph Service
  nebula-graphd:
    image: vesoft/nebula-graphd:v3.8.0
    container_name: nebula-graphd
    restart: unless-stopped
    ports:
      - "9669:9669"
      - "19669:19669"
    environment:
      - USER=root
    volumes:
      - nebula-data:/usr/local/nebula/data
      - nebula-logs:/usr/local/nebula/logs
    networks:
      - nebula-net
    depends_on:
      - nebula-metad
      - nebula-storaged
    command:
      - --meta_server_addrs=nebula-metad:9559
      - --local_ip=nebula-graphd
      - --ws_ip=nebula-graphd
      - --port=9669
      - --ws_http_port=19669

  # NebulaGraph Console (for management)
  nebula-console:
    image: vesoft/nebula-console:v3.8.0
    container_name: nebula-console
    networks:
      - nebula-net
    depends_on:
      - nebula-graphd
    profiles:
      - console
    stdin_open: true
    tty: true
    command: ["nebula-console", "-addr", "nebula-graphd", "-port", "9669", "-u", "root", "-p", "nebula"]

volumes:
  nebula-data:
  nebula-meta:
  nebula-storage:
  nebula-logs:

networks:
  nebula-net:
    driver: bridge
